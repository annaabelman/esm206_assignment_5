---
title: "ESM206 Assignment 5"
author: "Anna Abelman"
date: "11/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

### Introduction: (EMMA)

### Data Methods: (ANNA)

### Results:

```{r}
#attach packages
library(tidyverse)
library(janitor)
library(kableExtra)
library(ggbeeswarm)
library(here)
library(effsize)
library(ggridges)
```

```{r}
#read in data and clean names
mack_creek <- read_csv(here::here("raw_data", "mack_creek_vertebrates.csv")) %>% 
  clean_names()
  
```

##### A.
```{r}
#group Giant Pac. Sals by year and count vy section
pacific_sal_n <- mack_creek %>% 
  filter(species == "DITE") %>% 
  group_by(year) %>% 
  count(section)
  
```

```{r}
ggplot(pacific_sal_n, aes(x = year, y = n)) +
  geom_line(aes(color = section),  show.legend = FALSE) +
   scale_color_manual(values = c("saddlebrown", "forestgreen")) +
  annotate(geom = "text", 
           x = 2000.7, y = 100, size = 3.5, fontface = 2,
           label = "Clear Cut", color = "saddlebrown") +
  annotate(geom = "text", 
           x = 1997.9, y = 190, size = 3.5, fontface = 2,
           label = "Old Growth", color = "forestgreen") +
  labs(x = "Year", 
       y = "Number of Salamanders",
       title = "Salamander Abundance in Mack Creek, 1993-2017") +
  theme_bw() +
  theme(axis.line = element_line(color = "black"), 
                    panel.border = element_blank(),
                    panel.grid.major = element_blank(),
                    panel.grid.minor = element_blank()) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(expand = c(0,0), limits = c(1993, 2017)) +
  scale_y_continuous(expand = c(0,0), limits = c(50, 400)) 
  

```
**Figure 1.** ADD CAPTION AND MAKE PRETTY AND ANALYZE (EMMA)

##### B.
**Table 1**: ADD CAPTION AND MAKE PRETTY (ANNA)
```{r}
pacific_sal_class <- mack_creek %>%
  filter(year =="2017", species == "DITE", 
         unittype %in% c("C", "P", "SC")) %>%
  count(unittype, section)

pacific_sal_table <- pacific_sal_class %>% 
  pivot_wider(names_from = unittype, values_from = n)

pacific_sal_props <- pacific_sal_table %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

kable(pacific_sal_props) %>% 
  kable_styling()
```

##### C.

```{r}
#chi-square test for measuring proportions
chi_sal <- pacific_sal_table %>% 
  select(-section)

chi_sal_test <- chisq.test(chi_sal)


```


There is no significant effect of forest condition (old growth or clear cut) on where in the channel salamanders are found (channel classification) ($\chi$^2^(`r chi_sal_test$parameter`) = `r round(chi_sal_test$statistic, 2)`, *p* = `r round(chi_sal_test$p.value, 2)`),(*p* > 0.05).**TALK ABOUT ACTUAL PROPORTIONS**

##### D.
```{r, include = FALSE}
sal_weight_section <- mack_creek %>% 
  select(year, species, section, weight) %>% 
  filter(year == "2017", species == "DITE") %>% 
  group_by(section) %>% 
  mutate(
    mean_weight = mean(weight)
  )

#visually exlore data for normality with
ggplot(sal_weight_section, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~section)

#explore with quantile quantile plots too
ggplot(sal_weight_section, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~section)

#they don't look normally distributed, BUT sample size is large enough that the central limit theorem applies- means are normally distributed
```


```{r}
#create vector of salamander weights for CC
sal_cc <- sal_weight_section %>% 
  filter(section == "CC") %>% 
  pull(weight)

#create vector of salamander weights for OG
sal_og <- sal_weight_section %>% 
  filter(section == "OG") %>% 
  pull(weight)

#t-test, salamander weights OG vs CC
sal_og_cc_tt <- t.test(sal_cc, sal_og)
#p > .05, no significant difference

#calculate Cohen's d
sal_og_cc_d <- cohen.d(sal_cc, sal_og, na.rm = TRUE)
#smol d, smol effect size p accurate
```

```{r}
# creating values of each of the analysis to use in text
#means
mean_cc <- mean(sal_cc)
mean_og <- mean(sal_og)

#standard deviation
sd_cc <- sd(sal_cc)
sd_og <- sd(sal_og)

#sample size
n_cc <- length(sal_cc)
n_og <- length(sal_og)
```


In 2017, the mean weights of the Pacific Giant Salamanders in clear cut forest sections (`r round(mean_cc, 2)` $\pm$ `r round(sd_cc, 2)`, n = `r n_cc`) did not differ significantly from old growth forest sections (`r round(mean_og, 2)` $\pm$ `r round(sd_og, 2)`, n = `r n_og`) by a unpaired two-sample t-test (t(`r round(sal_og_cc_tt$parameter, 2)`) = `r round(sal_og_cc_tt$statistic, 2)`, *p* > 0.005). The Cohen's d calculation (d = `r round(sal_og_cc_d$estimate, 2)`, *d* < 0.2) shows a small effect size, so our p-value is most likely accurate.

##### E. 

```{r}
sal_weight_class <- mack_creek %>% 
  select(year, species, unittype, weight) %>% 
  filter(year == "2017", species == "DITE", 
         unittype %in% c("C", "P", "SC")) %>% 
  group_by(unittype) %>% 
  mutate(
    mean_weight = mean(weight, na.rm = TRUE),
    sd_weight = sd(weight, na.rm = TRUE)
  )

```

```{r}
ggplot(sal_weight_class, aes(x = unittype, y = weight)) +
  geom_beeswarm(size = 1, alpha = .4, 
                color = "seagreen") +
  geom_point(aes(x = unittype, y = mean_weight),
             size = 2) +
  geom_errorbar(aes(x = unittype,
                    ymin = 0,
                   ymax = mean_weight + sd_weight),
                width = 0.1)
```
**Figure 2.** ADD CAPTION AND MAKE PRETTY AND ANALYZE

```{r, include = FALSE}
#visually explore to check for normality:
ggplot(sal_weight_class, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~unittype)

#explore with quantile quantile plots too
ggplot(sal_weight_class, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~unittype)

#they don't look normal, but central limit theorem makes our lives easy
```


```{r}
#ANOVA! 

sal_class_aov <- aov(weight ~ unittype, 
                     data = sal_weight_class)
summary(sal_class_aov)
sal_aov_outputs <- unlist(summary(sal_class_aov))

sal_aov_outputs
#we get a significant difference between at least one group
#so now we have to do post-hoc test

#tukey-test
TukeyHSD(sal_class_aov)

```
The only two that have a significant difference in means are Side channels and pools. (p < .05)

Mean weight of Pacific Giant Salamanders (g) did not differ significantly across pools, channels, and side channels (one-way ANOVA, F(r sal_aov_outputs[1], r sal_aov_outputs[2]) = r round(sal_aov_outputs[7],2, *p* = r round(sal_aov_outputs[9], 3)).
** ANALYZE MEAN DIFFERENCES, PERCENT DIFFERENCES, AND EFFECT SIZES**
iii) concerns: there are a lot of outliers, so means are skewed, so maybe medians are better 

### Summary:


### References